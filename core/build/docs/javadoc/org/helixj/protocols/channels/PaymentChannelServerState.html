<!DOCTYPE HTML>
<!-- NewPage -->
<html lang="fr">
<head>
<!-- Generated by javadoc -->
<title>PaymentChannelServerState (core 0.15.8 API)</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="description" content="declaration: package: org.helixj.protocols.channels, class: PaymentChannelServerState">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../script-dir/jquery-ui.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
<script type="text/javascript" src="../../../../script-dir/jszip/dist/jszip.min.js"></script>
<script type="text/javascript" src="../../../../script-dir/jszip-utils/dist/jszip-utils.min.js"></script>
<!--[if IE]>
<script type="text/javascript" src="../../../../script-dir/jszip-utils/dist/jszip-utils-ie.min.js"></script>
<![endif]-->
<script type="text/javascript" src="../../../../script-dir/jquery-3.4.1.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-ui.js"></script>
</head>
<body class="class-declaration">
<script type="text/javascript">var data = {"i0":6,"i1":6,"i2":10,"i3":6,"i4":6,"i5":10,"i6":10,"i7":10,"i8":6,"i9":6,"i10":6,"i11":10,"i12":6,"i13":10,"i14":10,"i15":10,"i16":10,"i17":10,"i18":10,"i19":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],4:["t3","Abstract Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
var pathtoroot = "../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<header role="banner">
<nav role="navigation">
<div class="fixedNav">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a id="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested.class.summary">Nested</a>&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<div class="navListSearch"><label for="search">SEARCH:</label>
<input type="text" id="search" value="search" disabled="disabled">
<input type="reset" id="reset" value="reset" disabled="disabled">
</div>
</div>
<a id="skip.navbar.top">
<!--   -->
</a>
<!-- ========= END OF TOP NAVBAR ========= -->
</div>
<div class="navPadding">&nbsp;</div>
<script type="text/javascript"><!--
$('.navPadding').css('padding-top', $('.fixedNav').css("height"));
//-->
</script>
</nav>
</header>
<!-- ======== START OF CLASS DATA ======== -->
<main role="main">
<div class="header">
<div class="subTitle"><span class="packageLabelInType">Package</span>&nbsp;<a href="package-summary.html">org.helixj.protocols.channels</a></div>
<h1 title="Class PaymentChannelServerState" class="title">Class PaymentChannelServerState</h1>
</div>
<div class="contentContainer">
<div class="inheritance" title="Inheritance Tree">java.lang.Object
<div class="inheritance">org.helixj.protocols.channels.PaymentChannelServerState</div>
</div>
<section class="description">
<dl>
<dt>Direct Known Subclasses:</dt>
<dd><code><a href="PaymentChannelV1ServerState.html" title="class in org.helixj.protocols.channels">PaymentChannelV1ServerState</a></code>, <code><a href="PaymentChannelV2ServerState.html" title="class in org.helixj.protocols.channels">PaymentChannelV2ServerState</a></code></dd>
</dl>
<hr>
<pre>public abstract class <span class="typeNameLabel">PaymentChannelServerState</span>
extends java.lang.Object</pre>
<div class="block"><p>A payment channel is a method of sending money to someone such that the amount of money you send can be adjusted
 after the fact, in an efficient manner that does not require broadcasting to the network. This can be used to
 implement micropayments or other payment schemes in which immediate settlement is not required, but zero trust
 negotiation is. Note that this class only allows the amount of money received to be incremented, not decremented.</p>

 <p>There are two subclasses that implement this one, for versions 1 and 2 of the protocol -
 <a href="PaymentChannelV1ServerState.html" title="class in org.helixj.protocols.channels"><code>PaymentChannelV1ServerState</code></a> and <a href="PaymentChannelV2ServerState.html" title="class in org.helixj.protocols.channels"><code>PaymentChannelV2ServerState</code></a>.</p>

 <p>This class implements the core state machine for the server side of the protocol. The client side is implemented
 by <a href="PaymentChannelV1ClientState.html" title="class in org.helixj.protocols.channels"><code>PaymentChannelV1ClientState</code></a> and <a href="PaymentChannelServerListener.html" title="class in org.helixj.protocols.channels"><code>PaymentChannelServerListener</code></a> implements the server-side network
 protocol listening for TCP/IP connections and moving this class through each state. We say that the party who is
 sending funds is the <i>client</i> or <i>initiating party</i>. The party that is receiving the funds is the
 <i>server</i> or <i>receiving party</i>. Although the underlying Bitcoin protocol is capable of more complex
 relationships than that, this class implements only the simplest case.</p>

 <p>To protect clients from malicious servers, a channel has an expiry parameter. When this expiration is reached, the
 client will broadcast the created refund  transaction and take back all the money in this channel. Because this is
 specified in terms of block timestamps, it is fairly fuzzy and it is possible to spend the refund transaction up to a
 few hours before the actual timestamp. Thus, it is very important that the channel be closed with plenty of time left
 to get the highest value payment transaction confirmed before the expire time (minimum 3-4 hours is suggested if the
 payment transaction has enough fee to be confirmed in the next block or two).</p>

 <p>To begin, we must provide the client with a pubkey which we wish to use for the multi-sig contract which locks in
 the channel. The client will then provide us with an incomplete refund transaction and the pubkey which they used in
 the multi-sig contract. We use this pubkey to recreate the multi-sig output and then sign that to the refund
 transaction. We provide that signature to the client and they then have the ability to spend the refund transaction
 at the specified expire time. The client then provides us with the full, signed multi-sig contract which we verify
 and broadcast, locking in their funds until we spend a payment transaction or the expire time is reached. The client
 can then begin paying by providing us with signatures for the multi-sig contract which pay some amount back to the
 client, and the rest is ours to do with as we wish.</p></div>
</section>
<section class="summary">
<ul class="blockList">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<li class="blockList">
<section class="nestedClassSummary"><a id="nested.class.summary">
<!--   -->
</a>
<h2>Nested Class Summary</h2>
<div class="memberSummary">
<table>
<caption><span>Nested Classes</span><span class="tabEnd">&nbsp;</span></caption>
<thead>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colSecond" scope="col">Class</th>
<th class="colLast" scope="col">Description</th>
</tr>
</thead>
<tbody>
<tr class="altColor">
<td class="colFirst"><code>static class&nbsp;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="PaymentChannelServerState.State.html" title="enum in org.helixj.protocols.channels">PaymentChannelServerState.State</a></span></code></th>
<td class="colLast">
<div class="block">The different logical states the channel can be in.</div>
</td>
</tr>
</tbody>
</table>
</div>
</section>
</li>
<!-- =========== FIELD SUMMARY =========== -->
<li class="blockList">
<section class="fieldSummary"><a id="field.summary">
<!--   -->
</a>
<h2>Field Summary</h2>
<div class="memberSummary">
<table>
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<thead>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colSecond" scope="col">Field</th>
<th class="colLast" scope="col">Description</th>
</tr>
</thead>
<tbody>
<tr class="altColor">
<td class="colFirst"><code>protected byte[]</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#bestValueSignature">bestValueSignature</a></span></code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected <a href="../../core/Coin.html" title="class in org.helixj.core">Coin</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#bestValueToMe">bestValueToMe</a></span></code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected <a href="../../core/TransactionBroadcaster.html" title="interface in org.helixj.core">TransactionBroadcaster</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#broadcaster">broadcaster</a></span></code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected <a href="../../core/Transaction.html" title="class in org.helixj.core">Transaction</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#contract">contract</a></span></code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected long</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#minExpireTime">minExpireTime</a></span></code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected <a href="../../core/ECKey.html" title="class in org.helixj.core">ECKey</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#serverKey">serverKey</a></span></code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected <a href="StateMachine.html" title="class in org.helixj.protocols.channels">StateMachine</a>&lt;<a href="PaymentChannelServerState.State.html" title="enum in org.helixj.protocols.channels">PaymentChannelServerState.State</a>&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#stateMachine">stateMachine</a></span></code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected <a href="StoredServerChannel.html" title="class in org.helixj.protocols.channels">StoredServerChannel</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#storedServerChannel">storedServerChannel</a></span></code></th>
<td class="colLast">&nbsp;</td>
</tr>
</tbody>
</table>
</div>
</section>
</li>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<li class="blockList">
<section class="constructorSummary"><a id="constructor.summary">
<!--   -->
</a>
<h2>Constructor Summary</h2>
<div class="memberSummary">
<table>
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<thead>
<tr>
<th class="colFirst" scope="col">Constructor</th>
<th class="colLast" scope="col">Description</th>
</tr>
</thead>
<tbody>
<tr class="altColor">
<th class="colConstructorName" scope="row"><code><span class="memberNameLink"><a href="#%3Cinit%3E(org.helixj.core.TransactionBroadcaster,org.helixj.wallet.Wallet,org.helixj.core.ECKey,long)">PaymentChannelServerState</a></span>&#8203;(<a href="../../core/TransactionBroadcaster.html" title="interface in org.helixj.core">TransactionBroadcaster</a>&nbsp;broadcaster,
<a href="../../wallet/Wallet.html" title="class in org.helixj.wallet">Wallet</a>&nbsp;wallet,
<a href="../../core/ECKey.html" title="class in org.helixj.core">ECKey</a>&nbsp;serverKey,
long&nbsp;minExpireTime)</code></th>
<td class="colLast">
<div class="block">Creates a new state object to track the server side of a payment channel.</div>
</td>
</tr>
</tbody>
</table>
</div>
</section>
</li>
<!-- ========== METHOD SUMMARY =========== -->
<li class="blockList">
<section class="methodSummary"><a id="method.summary">
<!--   -->
</a>
<h2>Method Summary</h2>
<div class="memberSummary">
<div role="tablist" aria-orientation="horizontal"><button role="tab" aria-selected="true" aria-controls="memberSummary_tabpanel" tabindex="0" onkeydown="switchTab(event)" id="t0" class="activeTableTab">All Methods</button><button role="tab" aria-selected="false" aria-controls="memberSummary_tabpanel" tabindex="-1" onkeydown="switchTab(event)" id="t2" class="tableTab" onclick="show(2);">Instance Methods</button><button role="tab" aria-selected="false" aria-controls="memberSummary_tabpanel" tabindex="-1" onkeydown="switchTab(event)" id="t3" class="tableTab" onclick="show(4);">Abstract Methods</button><button role="tab" aria-selected="false" aria-controls="memberSummary_tabpanel" tabindex="-1" onkeydown="switchTab(event)" id="t4" class="tableTab" onclick="show(8);">Concrete Methods</button></div>
<div id="memberSummary_tabpanel" role="tabpanel">
<table aria-labelledby="t0">
<thead>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colSecond" scope="col">Method</th>
<th class="colLast" scope="col">Description</th>
</tr>
</thead>
<tbody>
<tr class="altColor" id="i0">
<td class="colFirst"><code>abstract com.google.common.util.concurrent.ListenableFuture&lt;<a href="../../core/Transaction.html" title="class in org.helixj.core">Transaction</a>&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#close()">close</a></span>()</code></th>
<td class="colLast">
<div class="block">Closes this channel and broadcasts the highest value payment transaction on the network.</div>
</td>
</tr>
<tr class="rowColor" id="i1">
<td class="colFirst"><code>protected abstract <a href="../../script/Script.html" title="class in org.helixj.script">Script</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#createOutputScript()">createOutputScript</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="altColor" id="i2">
<td class="colFirst"><code><a href="../../core/Coin.html" title="class in org.helixj.core">Coin</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getBestValueToMe()">getBestValueToMe</a></span>()</code></th>
<td class="colLast">
<div class="block">Gets the highest payment to ourselves (which we will receive on settle(), not including fees)</div>
</td>
</tr>
<tr class="rowColor" id="i3">
<td class="colFirst"><code>protected abstract <a href="../../core/ECKey.html" title="class in org.helixj.core">ECKey</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getClientKey()">getClientKey</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="altColor" id="i4">
<td class="colFirst"><code>abstract <a href="../../core/TransactionOutput.html" title="class in org.helixj.core">TransactionOutput</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getClientOutput()">getClientOutput</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="rowColor" id="i5">
<td class="colFirst"><code><a href="../../core/Transaction.html" title="class in org.helixj.core">Transaction</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getContract()">getContract</a></span>()</code></th>
<td class="colLast">
<div class="block">Gets the multisig contract which was used to initialize this channel</div>
</td>
</tr>
<tr class="altColor" id="i6">
<td class="colFirst"><code><a href="../../script/Script.html" title="class in org.helixj.script">Script</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getContractScript()">getContractScript</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="rowColor" id="i7">
<td class="colFirst"><code>long</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getExpiryTime()">getExpiryTime</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="altColor" id="i8">
<td class="colFirst"><code>abstract <a href="../../core/Coin.html" title="class in org.helixj.core">Coin</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getFeePaid()">getFeePaid</a></span>()</code></th>
<td class="colLast">
<div class="block">Gets the fee paid in the final payment transaction (only available if settle() did not throw an exception)</div>
</td>
</tr>
<tr class="rowColor" id="i9">
<td class="colFirst"><code>abstract int</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getMajorVersion()">getMajorVersion</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="altColor" id="i10">
<td class="colFirst"><code>protected abstract <a href="../../script/Script.html" title="class in org.helixj.script">Script</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getSignedScript()">getSignedScript</a></span>()</code></th>
<td class="colLast">
<div class="block">Gets the script that signatures should sign against.</div>
</td>
</tr>
<tr class="rowColor" id="i11">
<td class="colFirst"><code><a href="PaymentChannelServerState.State.html" title="enum in org.helixj.protocols.channels">PaymentChannelServerState.State</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getState()">getState</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="altColor" id="i12">
<td class="colFirst"><code>protected abstract com.google.common.collect.Multimap&lt;<a href="PaymentChannelServerState.State.html" title="enum in org.helixj.protocols.channels">PaymentChannelServerState.State</a>,&#8203;<a href="PaymentChannelServerState.State.html" title="enum in org.helixj.protocols.channels">PaymentChannelServerState.State</a>&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getStateTransitions()">getStateTransitions</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="rowColor" id="i13">
<td class="colFirst"><code>protected <a href="../../core/Coin.html" title="class in org.helixj.core">Coin</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getTotalValue()">getTotalValue</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="altColor" id="i14">
<td class="colFirst"><code>boolean</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#incrementPayment(org.helixj.core.Coin,byte%5B%5D)">incrementPayment</a></span>&#8203;(<a href="../../core/Coin.html" title="class in org.helixj.core">Coin</a>&nbsp;refundSize,
byte[]&nbsp;signatureBytes)</code></th>
<td class="colLast">
<div class="block">Called when the client provides us with a new signature and wishes to increment total payment by size</div>
</td>
</tr>
<tr class="rowColor" id="i15">
<td class="colFirst"><code>protected <a href="../../wallet/SendRequest.html" title="class in org.helixj.wallet">SendRequest</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#makeUnsignedChannelContract(org.helixj.core.Coin)">makeUnsignedChannelContract</a></span>&#8203;(<a href="../../core/Coin.html" title="class in org.helixj.core">Coin</a>&nbsp;valueToMe)</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="altColor" id="i16">
<td class="colFirst"><code>com.google.common.util.concurrent.ListenableFuture&lt;<a href="PaymentChannelServerState.html" title="class in org.helixj.protocols.channels">PaymentChannelServerState</a>&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#provideContract(org.helixj.core.Transaction)">provideContract</a></span>&#8203;(<a href="../../core/Transaction.html" title="class in org.helixj.core">Transaction</a>&nbsp;contract)</code></th>
<td class="colLast">
<div class="block">Called when the client provides the multi-sig contract.</div>
</td>
</tr>
<tr class="rowColor" id="i17">
<td class="colFirst"><code>void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#storeChannelInWallet(org.helixj.protocols.channels.PaymentChannelServer)">storeChannelInWallet</a></span>&#8203;(<a href="PaymentChannelServer.html" title="class in org.helixj.protocols.channels">PaymentChannelServer</a>&nbsp;connectedHandler)</code></th>
<td class="colLast">
<div class="block">Stores this channel's state in the wallet as a part of a <a href="StoredPaymentChannelServerStates.html" title="class in org.helixj.protocols.channels"><code>StoredPaymentChannelServerStates</code></a> wallet
 extension and keeps it up-to-date each time payment is incremented.</div>
</td>
</tr>
<tr class="altColor" id="i18">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#updateChannelInWallet()">updateChannelInWallet</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="rowColor" id="i19">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#verifyContract(org.helixj.core.Transaction)">verifyContract</a></span>&#8203;(<a href="../../core/Transaction.html" title="class in org.helixj.core">Transaction</a>&nbsp;contract)</code></th>
<td class="colLast">
<div class="block">Verifies that the given contract meets a set of extra requirements</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="inheritedList">
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<a id="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a><code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<li class="blockList">
<section class="fieldDetails"><a id="field.detail">
<!--   -->
</a>
<h2>Field Details</h2>
<ul class="blockList">
<li class="blockList">
<section class="detail">
<h3><a id="stateMachine">stateMachine</a></h3>
<div class="memberSignature"><span class="modifiers">protected</span>&nbsp;<span class="returnType"><a href="StateMachine.html" title="class in org.helixj.protocols.channels">StateMachine</a>&lt;<a href="PaymentChannelServerState.State.html" title="enum in org.helixj.protocols.channels">PaymentChannelServerState.State</a>&gt;</span>&nbsp;<span class="memberName">stateMachine</span></div>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="broadcaster">broadcaster</a></h3>
<div class="memberSignature"><span class="modifiers">protected final</span>&nbsp;<span class="returnType"><a href="../../core/TransactionBroadcaster.html" title="interface in org.helixj.core">TransactionBroadcaster</a></span>&nbsp;<span class="memberName">broadcaster</span></div>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="bestValueSignature">bestValueSignature</a></h3>
<div class="memberSignature"><span class="modifiers">protected</span>&nbsp;<span class="returnType">byte[]</span>&nbsp;<span class="memberName">bestValueSignature</span></div>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="bestValueToMe">bestValueToMe</a></h3>
<div class="memberSignature"><span class="modifiers">protected</span>&nbsp;<span class="returnType"><a href="../../core/Coin.html" title="class in org.helixj.core">Coin</a></span>&nbsp;<span class="memberName">bestValueToMe</span></div>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="serverKey">serverKey</a></h3>
<div class="memberSignature"><span class="modifiers">protected</span>&nbsp;<span class="returnType"><a href="../../core/ECKey.html" title="class in org.helixj.core">ECKey</a></span>&nbsp;<span class="memberName">serverKey</span></div>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="minExpireTime">minExpireTime</a></h3>
<div class="memberSignature"><span class="modifiers">protected</span>&nbsp;<span class="returnType">long</span>&nbsp;<span class="memberName">minExpireTime</span></div>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="storedServerChannel">storedServerChannel</a></h3>
<div class="memberSignature"><span class="modifiers">protected</span>&nbsp;<span class="returnType"><a href="StoredServerChannel.html" title="class in org.helixj.protocols.channels">StoredServerChannel</a></span>&nbsp;<span class="memberName">storedServerChannel</span></div>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="contract">contract</a></h3>
<div class="memberSignature"><span class="modifiers">protected</span>&nbsp;<span class="returnType"><a href="../../core/Transaction.html" title="class in org.helixj.core">Transaction</a></span>&nbsp;<span class="memberName">contract</span></div>
</section>
</li>
</ul>
</section>
</li>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<li class="blockList">
<section class="constructorDetails"><a id="constructor.detail">
<!--   -->
</a>
<h2>Constructor Details</h2>
<ul class="blockList">
<li class="blockList">
<section class="detail">
<h3><a id="&lt;init&gt;(org.helixj.core.TransactionBroadcaster,org.helixj.wallet.Wallet,org.helixj.core.ECKey,long)">PaymentChannelServerState</a></h3>
<div class="memberSignature"><span class="modifiers">public</span>&nbsp;<span class="memberName">PaymentChannelServerState</span>&#8203;(<span class="arguments"><a href="../../core/TransactionBroadcaster.html" title="interface in org.helixj.core">TransactionBroadcaster</a>&nbsp;broadcaster,
<a href="../../wallet/Wallet.html" title="class in org.helixj.wallet">Wallet</a>&nbsp;wallet,
<a href="../../core/ECKey.html" title="class in org.helixj.core">ECKey</a>&nbsp;serverKey,
long&nbsp;minExpireTime)</span></div>
<div class="block">Creates a new state object to track the server side of a payment channel.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>broadcaster</code> - The peer group which we will broadcast transactions to, this should have multiple peers</dd>
<dd><code>wallet</code> - The wallet which will be used to complete transactions</dd>
<dd><code>serverKey</code> - The private key which we use for our part of the multi-sig contract
                  (this MUST be fresh and CANNOT be used elsewhere)</dd>
<dd><code>minExpireTime</code> - The earliest time at which the client can claim the refund transaction (UNIX timestamp of block)</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
<!-- ============ METHOD DETAIL ========== -->
<li class="blockList">
<section class="methodDetails"><a id="method.detail">
<!--   -->
</a>
<h2>Method Details</h2>
<ul class="blockList">
<li class="blockList">
<section class="detail">
<h3><a id="getMajorVersion()">getMajorVersion</a></h3>
<div class="memberSignature"><span class="modifiers">public abstract</span>&nbsp;<span class="returnType">int</span>&nbsp;<span class="memberName">getMajorVersion</span>()</div>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="getState()">getState</a></h3>
<div class="memberSignature"><span class="modifiers">public</span>&nbsp;<span class="returnType"><a href="PaymentChannelServerState.State.html" title="enum in org.helixj.protocols.channels">PaymentChannelServerState.State</a></span>&nbsp;<span class="memberName">getState</span>()</div>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="getStateTransitions()">getStateTransitions</a></h3>
<div class="memberSignature"><span class="modifiers">protected abstract</span>&nbsp;<span class="returnType">com.google.common.collect.Multimap&lt;<a href="PaymentChannelServerState.State.html" title="enum in org.helixj.protocols.channels">PaymentChannelServerState.State</a>,&#8203;<a href="PaymentChannelServerState.State.html" title="enum in org.helixj.protocols.channels">PaymentChannelServerState.State</a>&gt;</span>&nbsp;<span class="memberName">getStateTransitions</span>()</div>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="provideContract(org.helixj.core.Transaction)">provideContract</a></h3>
<div class="memberSignature"><span class="modifiers">public</span>&nbsp;<span class="returnType">com.google.common.util.concurrent.ListenableFuture&lt;<a href="PaymentChannelServerState.html" title="class in org.helixj.protocols.channels">PaymentChannelServerState</a>&gt;</span>&nbsp;<span class="memberName">provideContract</span>&#8203;(<span class="arguments"><a href="../../core/Transaction.html" title="class in org.helixj.core">Transaction</a>&nbsp;contract)</span>
                                                                                              throws <span class="exceptions"><a href="../../core/VerificationException.html" title="class in org.helixj.core">VerificationException</a></span></div>
<div class="block">Called when the client provides the multi-sig contract.  Checks that the previously-provided refund transaction
 spends this transaction (because we will use it as a base to create payment transactions) as well as output value
 and form (ie it is a 2-of-2 multisig to the correct keys).</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>contract</code> - The provided multisig contract. Do not mutate this object after this call.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>A future which completes when the provided multisig contract successfully broadcasts, or throws if the broadcast fails for some reason
         Note that if the network simply rejects the transaction, this future will never complete, a timeout should be used.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../core/VerificationException.html" title="class in org.helixj.core">VerificationException</a></code> - If the provided multisig contract is not well-formed or does not meet previously-specified parameters</dd>
</dl>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="makeUnsignedChannelContract(org.helixj.core.Coin)">makeUnsignedChannelContract</a></h3>
<div class="memberSignature"><span class="modifiers">protected</span>&nbsp;<span class="returnType"><a href="../../wallet/SendRequest.html" title="class in org.helixj.wallet">SendRequest</a></span>&nbsp;<span class="memberName">makeUnsignedChannelContract</span>&#8203;(<span class="arguments"><a href="../../core/Coin.html" title="class in org.helixj.core">Coin</a>&nbsp;valueToMe)</span></div>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="incrementPayment(org.helixj.core.Coin,byte[])">incrementPayment</a></h3>
<div class="memberSignature"><span class="modifiers">public</span>&nbsp;<span class="returnType">boolean</span>&nbsp;<span class="memberName">incrementPayment</span>&#8203;(<span class="arguments"><a href="../../core/Coin.html" title="class in org.helixj.core">Coin</a>&nbsp;refundSize,
byte[]&nbsp;signatureBytes)</span>
                         throws <span class="exceptions"><a href="../../core/VerificationException.html" title="class in org.helixj.core">VerificationException</a>,
<a href="ValueOutOfRangeException.html" title="class in org.helixj.protocols.channels">ValueOutOfRangeException</a>,
<a href="../../core/InsufficientMoneyException.html" title="class in org.helixj.core">InsufficientMoneyException</a></span></div>
<div class="block">Called when the client provides us with a new signature and wishes to increment total payment by size.          +
 Verifies the provided signature and only updates values if everything checks out.
 If the new refundSize is not the lowest we have seen, it is simply ignored.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>refundSize</code> - How many satoshis of the original contract are refunded to the client (the rest are ours)</dd>
<dd><code>signatureBytes</code> - The new signature spending the multi-sig contract to a new payment transaction</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>true if there is more value left on the channel, false if it is now fully used up.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../core/VerificationException.html" title="class in org.helixj.core">VerificationException</a></code> - If the signature does not verify or size is out of range (incl being rejected by the network as dust).</dd>
<dd><code><a href="ValueOutOfRangeException.html" title="class in org.helixj.protocols.channels">ValueOutOfRangeException</a></code></dd>
<dd><code><a href="../../core/InsufficientMoneyException.html" title="class in org.helixj.core">InsufficientMoneyException</a></code></dd>
</dl>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="close()">close</a></h3>
<div class="memberSignature"><span class="modifiers">public abstract</span>&nbsp;<span class="returnType">com.google.common.util.concurrent.ListenableFuture&lt;<a href="../../core/Transaction.html" title="class in org.helixj.core">Transaction</a>&gt;</span>&nbsp;<span class="memberName">close</span>()
                                                                               throws <span class="exceptions"><a href="../../core/InsufficientMoneyException.html" title="class in org.helixj.core">InsufficientMoneyException</a></span></div>
<div class="block"><p>Closes this channel and broadcasts the highest value payment transaction on the network.</p></div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>a future which completes when the provided multisig contract successfully broadcasts, or throws if the
         broadcast fails for some reason. Note that if the network simply rejects the transaction, this future
         will never complete, a timeout should be used.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../core/InsufficientMoneyException.html" title="class in org.helixj.core">InsufficientMoneyException</a></code> - If the payment tx would have cost more in fees to spend than it is worth.</dd>
</dl>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="getBestValueToMe()">getBestValueToMe</a></h3>
<div class="memberSignature"><span class="modifiers">public</span>&nbsp;<span class="returnType"><a href="../../core/Coin.html" title="class in org.helixj.core">Coin</a></span>&nbsp;<span class="memberName">getBestValueToMe</span>()</div>
<div class="block">Gets the highest payment to ourselves (which we will receive on settle(), not including fees)</div>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="getFeePaid()">getFeePaid</a></h3>
<div class="memberSignature"><span class="modifiers">public abstract</span>&nbsp;<span class="returnType"><a href="../../core/Coin.html" title="class in org.helixj.core">Coin</a></span>&nbsp;<span class="memberName">getFeePaid</span>()</div>
<div class="block">Gets the fee paid in the final payment transaction (only available if settle() did not throw an exception)</div>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="getContract()">getContract</a></h3>
<div class="memberSignature"><span class="modifiers">public</span>&nbsp;<span class="returnType"><a href="../../core/Transaction.html" title="class in org.helixj.core">Transaction</a></span>&nbsp;<span class="memberName">getContract</span>()</div>
<div class="block">Gets the multisig contract which was used to initialize this channel</div>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="getExpiryTime()">getExpiryTime</a></h3>
<div class="memberSignature"><span class="modifiers">public</span>&nbsp;<span class="returnType">long</span>&nbsp;<span class="memberName">getExpiryTime</span>()</div>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="updateChannelInWallet()">updateChannelInWallet</a></h3>
<div class="memberSignature"><span class="modifiers">protected</span>&nbsp;<span class="returnType">void</span>&nbsp;<span class="memberName">updateChannelInWallet</span>()</div>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="storeChannelInWallet(org.helixj.protocols.channels.PaymentChannelServer)">storeChannelInWallet</a></h3>
<div class="memberSignature"><span class="modifiers">public</span>&nbsp;<span class="returnType">void</span>&nbsp;<span class="memberName">storeChannelInWallet</span>&#8203;(<span class="arguments">@Nullable
<a href="PaymentChannelServer.html" title="class in org.helixj.protocols.channels">PaymentChannelServer</a>&nbsp;connectedHandler)</span></div>
<div class="block">Stores this channel's state in the wallet as a part of a <a href="StoredPaymentChannelServerStates.html" title="class in org.helixj.protocols.channels"><code>StoredPaymentChannelServerStates</code></a> wallet
 extension and keeps it up-to-date each time payment is incremented. This will be automatically removed when
 a call to <a href="PaymentChannelV1ServerState.html#close()"><code>PaymentChannelV1ServerState.close()</code></a> completes successfully. A channel may only be stored after it
 has fully opened (ie state == State.READY).</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>connectedHandler</code> - Optional <a href="PaymentChannelServer.html" title="class in org.helixj.protocols.channels"><code>PaymentChannelServer</code></a> object that manages this object. This will
                         set the appropriate pointer in the newly created <a href="StoredServerChannel.html" title="class in org.helixj.protocols.channels"><code>StoredServerChannel</code></a> before it is
                         committed to wallet. If set, closing the state object will propagate the close to the
                         handler which can then do a TCP disconnect.</dd>
</dl>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="getClientOutput()">getClientOutput</a></h3>
<div class="memberSignature"><span class="modifiers">public abstract</span>&nbsp;<span class="returnType"><a href="../../core/TransactionOutput.html" title="class in org.helixj.core">TransactionOutput</a></span>&nbsp;<span class="memberName">getClientOutput</span>()</div>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="getContractScript()">getContractScript</a></h3>
<div class="memberSignature"><span class="modifiers">public</span>&nbsp;<span class="returnType"><a href="../../script/Script.html" title="class in org.helixj.script">Script</a></span>&nbsp;<span class="memberName">getContractScript</span>()</div>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="getSignedScript()">getSignedScript</a></h3>
<div class="memberSignature"><span class="modifiers">protected abstract</span>&nbsp;<span class="returnType"><a href="../../script/Script.html" title="class in org.helixj.script">Script</a></span>&nbsp;<span class="memberName">getSignedScript</span>()</div>
<div class="block">Gets the script that signatures should sign against. This is never a P2SH
 script, rather the script that would be inside a P2SH script.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
</dl>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="verifyContract(org.helixj.core.Transaction)">verifyContract</a></h3>
<div class="memberSignature"><span class="modifiers">protected</span>&nbsp;<span class="returnType">void</span>&nbsp;<span class="memberName">verifyContract</span>&#8203;(<span class="arguments"><a href="../../core/Transaction.html" title="class in org.helixj.core">Transaction</a>&nbsp;contract)</span></div>
<div class="block">Verifies that the given contract meets a set of extra requirements</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>contract</code> - </dd>
</dl>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="createOutputScript()">createOutputScript</a></h3>
<div class="memberSignature"><span class="modifiers">protected abstract</span>&nbsp;<span class="returnType"><a href="../../script/Script.html" title="class in org.helixj.script">Script</a></span>&nbsp;<span class="memberName">createOutputScript</span>()</div>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="getTotalValue()">getTotalValue</a></h3>
<div class="memberSignature"><span class="modifiers">protected</span>&nbsp;<span class="returnType"><a href="../../core/Coin.html" title="class in org.helixj.core">Coin</a></span>&nbsp;<span class="memberName">getTotalValue</span>()</div>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="getClientKey()">getClientKey</a></h3>
<div class="memberSignature"><span class="modifiers">protected abstract</span>&nbsp;<span class="returnType"><a href="../../core/ECKey.html" title="class in org.helixj.core">ECKey</a></span>&nbsp;<span class="memberName">getClientKey</span>()</div>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
</div>
</main>
<!-- ========= END OF CLASS DATA ========= -->
<footer role="contentinfo">
<nav role="navigation">
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a id="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested.class.summary">Nested</a>&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
</div>
<a id="skip.navbar.bottom">
<!--   -->
</a>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</nav>
</footer>
</body>
</html>
